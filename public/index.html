<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸¸æˆIDç®¡ç†ç³»ç»Ÿ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); color: #f1f5f9; min-height: 100vh; padding: 20px; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .container { width: 100%; max-width: 900px; background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border-radius: 20px; padding: 40px; box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3); border: 1px solid rgba(255, 255, 255, 0.1); margin: 20px; }
        header { text-align: center; margin-bottom: 40px; }
        h1 { font-size: 2.8rem; margin-bottom: 10px; background: linear-gradient(90deg, #60a5fa, #a78bfa, #f472b6); -webkit-background-clip: text; background-clip: text; color: transparent; font-weight: 800; }
        .subtitle { color: #94a3b8; font-size: 1.1rem; margin-bottom: 30px; }
        .tabs { display: flex; margin-bottom: 30px; background: rgba(15, 23, 42, 0.5); border-radius: 12px; padding: 5px; }
        .tab { flex: 1; padding: 15px; text-align: center; background: transparent; border: none; color: #94a3b8; font-size: 1.1rem; font-weight: 600; cursor: pointer; border-radius: 8px; transition: all 0.3s ease; }
        .tab.active { background: rgba(96, 165, 250, 0.2); color: #60a5fa; box-shadow: 0 4px 12px rgba(96, 165, 250, 0.2); }
        .tab:hover:not(.active) { background: rgba(255, 255, 255, 0.05); color: #cbd5e1; }
        .tab-content { display: none; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .tab-content.active { display: block; }
        .form-group { margin-bottom: 25px; }
        label { display: block; margin-bottom: 8px; font-weight: 600; color: #e2e8f0; font-size: 1rem; }
        .input-with-icon { position: relative; display: flex; align-items: center; }
        .input-icon { position: absolute; left: 15px; color: #64748b; font-size: 1.2rem; }
        input { width: 100%; padding: 16px 16px 16px 45px; background: rgba(15, 23, 42, 0.7); border: 2px solid rgba(100, 116, 139, 0.3); border-radius: 12px; color: white; font-size: 1rem; transition: all 0.3s ease; }
        input:focus { outline: none; border-color: #60a5fa; background: rgba(15, 23, 42, 0.9); box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.2); }
        input::placeholder { color: #64748b; }
        .form-note { font-size: 0.9rem; color: #94a3b8; margin-top: 6px; line-height: 1.4; }
        .button-group { display: flex; gap: 15px; margin-top: 35px; }
        button { flex: 1; padding: 18px; border: none; border-radius: 12px; font-weight: 700; font-size: 1.1rem; cursor: pointer; transition: all 0.3s ease; display: flex; justify-content: center; align-items: center; gap: 10px; }
        .primary-btn { background: linear-gradient(90deg, #3b82f6, #8b5cf6); color: white; }
        .primary-btn:hover:not(:disabled) { transform: translateY(-3px); box-shadow: 0 10px 25px rgba(59, 130, 246, 0.3); }
        .secondary-btn { background: rgba(255, 255, 255, 0.08); color: #cbd5e1; border: 1px solid rgba(255, 255, 255, 0.1); }
        .secondary-btn:hover { background: rgba(255, 255, 255, 0.12); transform: translateY(-2px); }
        button:disabled { opacity: 0.6; cursor: not-allowed; transform: none !important; box-shadow: none !important; }
        .status-card { background: rgba(15, 23, 42, 0.5); border-radius: 15px; padding: 25px; margin: 30px 0; border-left: 5px solid #10b981; }
        .status-item { display: flex; justify-content: space-between; margin-bottom: 12px; padding: 10px 0; border-bottom: 1px solid rgba(255, 255, 255, 0.05); }
        .status-item:last-child { margin-bottom: 0; border-bottom: none; }
        .status-label { color: #94a3b8; font-weight: 500; }
        .status-value { font-weight: 600; color: #60a5fa; max-width: 60%; word-break: break-all; text-align: right; }
        .result-container { margin-top: 30px; padding: 25px; border-radius: 15px; display: none; }
        .result-container.show { display: block; animation: fadeIn 0.5s ease; }
        .result-container.success { background: rgba(16, 185, 129, 0.1); border-left: 5px solid #10b981; }
        .result-container.error { background: rgba(239, 68, 68, 0.1); border-left: 5px solid #ef4444; }
        .result-title { font-weight: 700; margin-bottom: 15px; display: flex; align-items: center; gap: 10px; font-size: 1.2rem; }
        .result-content { font-family: 'Consolas', 'Monaco', monospace; white-space: pre-wrap; background: rgba(0, 0, 0, 0.3); padding: 18px; border-radius: 10px; margin-top: 15px; font-size: 0.95rem; max-height: 350px; overflow-y: auto; line-height: 1.5; }
        .loading-spinner { display: inline-block; width: 20px; height: 20px; border: 3px solid rgba(255, 255, 255, 0.3); border-radius: 50%; border-top-color: #60a5fa; animation: spin 1s ease-in-out infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        @media (max-width: 768px) { .container { padding: 25px; } h1 { font-size: 2.2rem; } .button-group { flex-direction: column; } .tabs { flex-direction: column; } }
        footer { text-align: center; margin-top: 40px; color: #64748b; font-size: 0.9rem; width: 100%; }
        .security-badge { display: inline-flex; align-items: center; gap: 8px; background: rgba(16, 185, 129, 0.15); color: #10b981; padding: 8px 16px; border-radius: 20px; font-size: 0.9rem; margin-top: 10px; }
        .error-text { color: #ef4444; font-size: 0.9rem; margin-top: 5px; display: none; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ® æ¸¸æˆIDå®‰å…¨ç®¡ç†ç³»ç»Ÿ</h1>
            <p class="subtitle">å®‰å…¨ç™»å½•å¹¶ç®¡ç†æ‚¨çš„æ¸¸æˆèº«ä»½æ ‡è¯†</p>
            <div class="security-badge">
                <span>ğŸ”’</span> æ‰€æœ‰æ•æ„Ÿæ“ä½œå‡é€šè¿‡å®‰å…¨åç«¯å¤„ç†
            </div>
        </header>
        
        <div class="tabs">
            <button class="tab active" data-tab="login">ğŸ” è´¦æˆ·ç™»å½•</button>
            <button class="tab" data-tab="modify">ğŸ†” ä¿®æ”¹æ¸¸æˆID</button>
            <button class="tab" data-tab="status">ğŸ“Š ç³»ç»ŸçŠ¶æ€</button>
        </div>
        
        <div id="login-tab" class="tab-content active">
            <div class="form-group">
                <label for="login-email">ğŸ“§ é‚®ç®±åœ°å€</label>
                <div class="input-with-icon">
                    <span class="input-icon">âœ‰ï¸</span>
                    <input type="email" id="login-email" placeholder="è¯·è¾“å…¥æ‚¨çš„æ¸¸æˆè´¦æˆ·é‚®ç®±" 
                           value="liewhy1699@gmail.com">
                </div>
                <div class="error-text" id="email-error">è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€ï¼ˆä¾‹å¦‚ï¼šexample@gmail.comï¼‰</div>
            </div>
            
            <div class="form-group">
                <label for="login-password">ğŸ”‘ å¯†ç </label>
                <div class="input-with-icon">
                    <span class="input-icon">ğŸ—ï¸</span>
                    <input type="password" id="login-password" placeholder="è¯·è¾“å…¥æ‚¨çš„å¯†ç ">
                </div>
                <div class="error-text" id="password-error">å¯†ç ä¸èƒ½å°‘äº6ä¸ªå­—ç¬¦</div>
                <div class="form-note">æ‚¨çš„å¯†ç ä»…ç”¨äºè·å–Firebaseä»¤ç‰Œï¼Œä¸ä¼šè¢«å­˜å‚¨</div>
            </div>
            
            <div class="button-group">
                <button id="login-btn" class="primary-btn">
                    <span>ğŸš€ ç™»å½•è´¦æˆ·</span>
                </button>
            </div>
            
            <div class="status-card" style="display: none;" id="login-status">
                <div class="status-item">
                    <span class="status-label">ç™»å½•çŠ¶æ€ï¼š</span>
                    <span id="login-status-text" class="status-value">ç­‰å¾…ç™»å½•...</span>
                </div>
                <div class="status-item">
                    <span class="status-label">ç”¨æˆ·IDï¼š</span>
                    <span id="user-id" class="status-value">æœªè·å–</span>
                </div>
                <div class="status-item">
                    <span class="status-label">ä»¤ç‰ŒçŠ¶æ€ï¼š</span>
                    <span id="token-status" class="status-value">æœªè·å–</span>
                </div>
            </div>
        </div>
        
        <div id="modify-tab" class="tab-content">
            <div class="status-card">
                <div class="status-item">
                    <span class="status-label">å½“å‰ç™»å½•ï¼š</span>
                    <span id="current-user-email" class="status-value">è¯·å…ˆç™»å½•</span>
                </div>
                <div class="status-item">
                    <span class="status-label">åç«¯APIï¼š</span>
                    <span id="backend-url" class="status-value">ç­‰å¾…é…ç½®</span>
                </div>
            </div>
            
            <div class="form-group">
                <label for="new-local-id">ğŸ†• æ–°çš„æ¸¸æˆID</label>
                <div class="input-with-icon">
                    <span class="input-icon">ğŸ·ï¸</span>
                    <input type="text" id="new-local-id" placeholder="è¯·è¾“å…¥æ–°çš„æ¸¸æˆIDï¼ˆä¾‹å¦‚ï¼šCHARLESï¼‰" 
                           value="CHARLES">
                </div>
                <div class="error-text" id="id-error">æ¸¸æˆIDä¸èƒ½ä¸ºç©º</div>
                <div class="form-note">æ”¯æŒç‰¹æ®Šæ ¼å¼ï¼š<code>[FF6B8B]å½©è‰²[C94661]åå­—</code></div>
            </div>
            
            <div class="button-group">
                <button id="modify-btn" class="primary-btn" disabled>
                    <span>âœ¨ ä¿®æ”¹æ¸¸æˆID</span>
                </button>
                <button id="generate-btn" class="secondary-btn">
                    <span>ğŸ² ç”ŸæˆéšæœºID</span>
                </button>
            </div>
            
            <div class="result-container" id="modify-result"></div>
        </div>
        
        <div id="status-tab" class="tab-content">
            <div class="status-card">
                <div class="status-item">
                    <span class="status-label">åç«¯çŠ¶æ€ï¼š</span>
                    <span id="backend-status" class="status-value">ç­‰å¾…æ£€æµ‹</span>
                </div>
                <div class="status-item">
                    <span class="status-label">è¿æ¥çŠ¶æ€ï¼š</span>
                    <span id="connection-status" class="status-value">æœªè¿æ¥</span>
                </div>
                <div class="status-item">
                    <span class="status-label">æœ€åæ“ä½œï¼š</span>
                    <span id="last-operation" class="status-value">æ— </span>
                </div>
            </div>
            
            <div class="form-group">
                <label for="backend-config">ğŸ”§ åç«¯æœåŠ¡å™¨åœ°å€</label>
                <div class="input-with-icon">
                    <span class="input-icon">ğŸŒ</span>
                    <input type="text" id="backend-config" placeholder="https://ä½ çš„åç«¯.onrender.com" 
                           value="">
                </div>
                <div class="form-note">è¯·è¾“å…¥ä½ çš„Renderåç«¯åœ°å€ï¼Œä¾‹å¦‚ï¼šhttps://game-id-backend.onrender.com</div>
            </div>
            
            <div class="button-group">
                <button id="check-status-btn" class="primary-btn">
                    <span>ğŸ”„ æ£€æŸ¥ç³»ç»ŸçŠ¶æ€</span>
                </button>
                <button id="save-config-btn" class="secondary-btn">
                    <span>ğŸ’¾ ä¿å­˜é…ç½®</span>
                </button>
                <button id="clear-data-btn" class="secondary-btn">
                    <span>ğŸ—‘ï¸ æ¸…é™¤æ•°æ®</span>
                </button>
            </div>
            
            <div class="result-container" id="status-result"></div>
        </div>
    </div>
    
    <footer>
        <p>Â© 2025 æ¸¸æˆIDç®¡ç†ç³»ç»Ÿ | ç‰ˆæœ¬ 3.0</p>
        <p style="margin-top: 5px; font-size: 0.8rem; color: #475569;">
            æ™ºèƒ½åç«¯åœ°å€æ£€æµ‹ | æ”¯æŒè‡ªå®šä¹‰é…ç½®
        </p>
    </footer>

    <script>
        // å…¨å±€çŠ¶æ€
        const appState = {
            isLoggedIn: false,
            userEmail: '',
            userId: '',
            firebaseToken: '',
            backendUrl: '', // è¿™é‡Œè®¾ä¸ºç©ºï¼Œè®©ç”¨æˆ·æ‰‹åŠ¨é…ç½®
            lastResponse: null
        };
        
        // DOMå…ƒç´ 
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const loginBtn = document.getElementById('login-btn');
        const modifyBtn = document.getElementById('modify-btn');
        const backendConfigInput = document.getElementById('backend-config');
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            // ä»æœ¬åœ°å­˜å‚¨åŠ è½½é…ç½®
            const savedBackendUrl = localStorage.getItem('backendUrl');
            if (savedBackendUrl) {
                appState.backendUrl = savedBackendUrl;
                backendConfigInput.value = savedBackendUrl;
                document.getElementById('backend-url').textContent = savedBackendUrl;
                document.getElementById('backend-status').textContent = 'å·²é…ç½®';
                
                // è‡ªåŠ¨æ£€æŸ¥çŠ¶æ€
                setTimeout(() => checkBackendStatus(), 500);
            } else {
                // æç¤ºç”¨æˆ·é…ç½®
                showResult('status-result', 'info', 
                    'âš ï¸ è¯·å…ˆé…ç½®åç«¯æœåŠ¡å™¨åœ°å€\n\n' +
                    '1. åœ¨"ç³»ç»ŸçŠ¶æ€"æ ‡ç­¾é¡µè¾“å…¥ä½ çš„Renderåç«¯åœ°å€\n' +
                    '2. ç‚¹å‡»"ä¿å­˜é…ç½®"æŒ‰é’®\n' +
                    '3. ç‚¹å‡»"æ£€æŸ¥ç³»ç»ŸçŠ¶æ€"æµ‹è¯•è¿æ¥\n\n' +
                    'ç¤ºä¾‹åœ°å€ï¼šhttps://your-backend-name.onrender.com');
            }
        });
        
        // æ ‡ç­¾é¡µåˆ‡æ¢
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const tabId = tab.getAttribute('data-tab');
                
                tabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                tabContents.forEach(content => {
                    content.classList.remove('active');
                    if (content.id === `${tabId}-tab`) {
                        content.classList.add('active');
                    }
                });
            });
        });
        
        // é‚®ç®±éªŒè¯å‡½æ•°
        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }
        
        // æ˜¾ç¤º/éšè—é”™è¯¯ä¿¡æ¯
        function showError(elementId, show) {
            const errorElement = document.getElementById(elementId);
            errorElement.style.display = show ? 'block' : 'none';
            return show;
        }
        
        // ç™»å½•åŠŸèƒ½
        loginBtn.addEventListener('click', async () => {
            if (!appState.backendUrl) {
                showResult('login-status', 'error', 
                    'âŒ è¯·å…ˆé…ç½®åç«¯æœåŠ¡å™¨åœ°å€\n\n' +
                    'åˆ‡æ¢åˆ°"ç³»ç»ŸçŠ¶æ€"æ ‡ç­¾é¡µï¼Œè¾“å…¥ä½ çš„Renderåç«¯åœ°å€å¹¶ä¿å­˜ã€‚');
                return;
            }
            
            const email = document.getElementById('login-email').value.trim();
            const password = document.getElementById('login-password').value;
            
            // éªŒè¯é‚®ç®±
            const emailError = showError('email-error', !isValidEmail(email));
            
            // éªŒè¯å¯†ç 
            const passwordError = showError('password-error', !password || password.length < 6);
            
            if (emailError || passwordError) {
                return;
            }
            
            // æ˜¾ç¤ºç™»å½•çŠ¶æ€
            const statusCard = document.getElementById('login-status');
            statusCard.style.display = 'block';
            document.getElementById('login-status-text').textContent = 'æ­£åœ¨ç™»å½•...';
            loginBtn.disabled = true;
            loginBtn.innerHTML = '<span class="loading-spinner"></span> ç™»å½•ä¸­...';
            
            try {
                // è°ƒç”¨åç«¯ç™»å½•API
                const response = await fetch(`${appState.backendUrl}/api/login`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({ email, password })
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.message || `ç™»å½•å¤±è´¥ (${response.status})`);
                }
                
                if (data.success) {
                    appState.isLoggedIn = true;
                    appState.userEmail = email;
                    appState.firebaseToken = data.token?.idToken || data.idToken;
                    appState.userId = data.user?.userId || data.userId;
                    
                    // æ›´æ–°UI
                    document.getElementById('login-status-text').textContent = 'ç™»å½•æˆåŠŸ';
                    document.getElementById('user-id').textContent = appState.userId || 'æœªçŸ¥';
                    document.getElementById('token-status').textContent = appState.firebaseToken ? 
                        'å·²è·å– (' + appState.firebaseToken.substring(0, 20) + '...)' : 'ç©º';
                    
                    document.getElementById('current-user-email').textContent = email;
                    modifyBtn.disabled = false;
                    
                    showResult('login-status', 'success', 
                        `âœ… ç™»å½•æˆåŠŸï¼\næ¬¢è¿å›æ¥ ${email}\nç”¨æˆ·ID: ${appState.userId}`);
                    
                    // è‡ªåŠ¨åˆ‡æ¢åˆ°ä¿®æ”¹æ ‡ç­¾é¡µ
                    document.querySelector('[data-tab="modify"]').click();
                } else {
                    throw new Error(data.message || 'ç™»å½•å¤±è´¥');
                }
            } catch (error) {
                document.getElementById('login-status-text').textContent = 'ç™»å½•å¤±è´¥';
                showResult('login-status', 'error', 
                    `âŒ ç™»å½•å¤±è´¥\né”™è¯¯ä¿¡æ¯: ${error.message}\n\nè¯·æ£€æŸ¥ï¼š\n1. åç«¯æœåŠ¡å™¨æ˜¯å¦è¿è¡Œ\n2. é‚®ç®±å¯†ç æ˜¯å¦æ­£ç¡®\n3. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸\n\nå½“å‰åç«¯åœ°å€ï¼š${appState.backendUrl}`);
            } finally {
                loginBtn.disabled = false;
                loginBtn.innerHTML = '<span>ğŸš€ ç™»å½•è´¦æˆ·</span>';
            }
        });
        
        // ä¿®æ”¹æ¸¸æˆID
        modifyBtn.addEventListener('click', async () => {
            if (!appState.isLoggedIn) {
                showResult('modify-result', 'error', 'è¯·å…ˆç™»å½•');
                return;
            }
            
            const newLocalId = document.getElementById('new-local-id').value.trim();
            const idError = showError('id-error', !newLocalId);
            
            if (idError) {
                return;
            }
            
            modifyBtn.disabled = true;
            modifyBtn.innerHTML = '<span class="loading-spinner"></span> ä¿®æ”¹ä¸­...';
            
            try {
                // è°ƒç”¨åç«¯ä¿®æ”¹ID API
                const response = await fetch(`${appState.backendUrl}/api/change-id`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({ 
                        newLocalId,
                        idToken: appState.firebaseToken
                    })
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.message || `ä¿®æ”¹å¤±è´¥ (${response.status})`);
                }
                
                if (data.success) {
                    showResult('modify-result', 'success', 
                        `âœ… æ¸¸æˆIDä¿®æ”¹æˆåŠŸï¼\n\n` +
                        `æ–°ID: ${data.gameResponse?.newLocalId || newLocalId}\n` +
                        `æ¶ˆæ¯: ${data.gameResponse?.message || 'ä¿®æ”¹æˆåŠŸ'}\n` +
                        `æ—¶é—´: ${new Date().toLocaleString()}\n\n` +
                        `å®Œæ•´å“åº”:\n${JSON.stringify(data.gameResponse || {}, null, 2)}`);
                    
                    // æ›´æ–°æœ€åæ“ä½œæ—¶é—´
                    document.getElementById('last-operation').textContent = 
                        `IDå·²ä¿®æ”¹ä¸º: ${data.gameResponse?.newLocalId || newLocalId}`;
                } else {
                    throw new Error(data.message || data.error || 'ä¿®æ”¹å¤±è´¥');
                }
            } catch (error) {
                showResult('modify-result', 'error', 
                    `âŒ ä¿®æ”¹å¤±è´¥\né”™è¯¯ä¿¡æ¯: ${error.message}\n\nå¯èƒ½çš„åŸå› ï¼š\n1. æ¸¸æˆAPIä¸å¯ç”¨\n2. Tokenå·²è¿‡æœŸ\n3. ç½‘ç»œè¿æ¥é—®é¢˜\n4. åç«¯åœ°å€é…ç½®é”™è¯¯`);
            } finally {
                modifyBtn.disabled = false;
                modifyBtn.innerHTML = '<span>âœ¨ ä¿®æ”¹æ¸¸æˆID</span>';
            }
        });
        
        // ç”ŸæˆéšæœºID
        document.getElementById('generate-btn').addEventListener('click', () => {
            const prefixes = ['CHARLES', 'DAVID', 'ALICE', 'BOB', 'EVE'];
            const suffix = Math.floor(100 + Math.random() * 900);
            const randomId = `${prefixes[Math.floor(Math.random() * prefixes.length)]}${suffix}`;
            document.getElementById('new-local-id').value = randomId;
        });
        
        // æ£€æŸ¥åç«¯çŠ¶æ€
        async function checkBackendStatus() {
            if (!appState.backendUrl) {
                showResult('status-result', 'error', 'è¯·å…ˆè¾“å…¥åç«¯æœåŠ¡å™¨åœ°å€');
                return;
            }
            
            const statusBtn = document.getElementById('check-status-btn');
            statusBtn.disabled = true;
            statusBtn.innerHTML = '<span class="loading-spinner"></span> æ£€æŸ¥ä¸­...';
            
            try {
                const response = await fetch(`${appState.backendUrl}/health`, {
                    method: 'GET',
                    headers: { 'Accept': 'application/json' }
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    document.getElementById('backend-status').textContent = 'è¿è¡Œæ­£å¸¸';
                    document.getElementById('connection-status').textContent = 'å·²è¿æ¥';
                    document.getElementById('backend-url').textContent = appState.backendUrl;
                    
                    showResult('status-result', 'success', 
                        `âœ… åç«¯æœåŠ¡å™¨è¿è¡Œæ­£å¸¸\n\n` +
                        `æœåŠ¡: ${data.service || 'æ¸¸æˆIDç®¡ç†åç«¯'}\n` +
                        `çŠ¶æ€: ${data.status || 'healthy'}\n` +
                        `æ—¶é—´: ${data.timestamp || new Date().toISOString()}\n` +
                        `ç¯å¢ƒ: ${data.environment || 'production'}`);
                } else {
                    throw new Error(`çŠ¶æ€å¼‚å¸¸: ${response.status}`);
                }
            } catch (error) {
                document.getElementById('backend-status').textContent = 'è¿æ¥å¤±è´¥';
                document.getElementById('connection-status').textContent = 'æœªè¿æ¥';
                
                showResult('status-result', 'error', 
                    `âŒ æ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡å™¨\n\n` +
                    `åœ°å€: ${appState.backendUrl}\n` +
                    `é”™è¯¯: ${error.message}\n\n` +
                    `è¯·æ£€æŸ¥ï¼š\n1. åç«¯æœåŠ¡å™¨æ˜¯å¦å¯åŠ¨\n2. åœ°å€æ˜¯å¦æ­£ç¡®\n3. ç½‘ç»œæ˜¯å¦é€šç•…\n4. RenderæœåŠ¡æ˜¯å¦åœ¨çº¿`);
            } finally {
                statusBtn.disabled = false;
                statusBtn.innerHTML = '<span>ğŸ”„ æ£€æŸ¥ç³»ç»ŸçŠ¶æ€</span>';
            }
        }
        
        document.getElementById('check-status-btn').addEventListener('click', checkBackendStatus);
        
        // ä¿å­˜é…ç½®
        document.getElementById('save-config-btn').addEventListener('click', () => {
            const newUrl = backendConfigInput.value.trim();
            if (!newUrl) {
                showResult('status-result', 'error', 'è¯·è¾“å…¥æœ‰æ•ˆçš„åç«¯åœ°å€');
                return;
            }
            
            // ç¡®ä¿URLä»¥http://æˆ–https://å¼€å¤´
            let finalUrl = newUrl;
            if (!newUrl.startsWith('http://') && !newUrl.startsWith('https://')) {
                finalUrl = 'https://' + newUrl;
                backendConfigInput.value = finalUrl;
            }
            
            // éªŒè¯URLæ ¼å¼
            try {
                new URL(finalUrl);
                appState.backendUrl = finalUrl;
                localStorage.setItem('backendUrl', finalUrl);
                document.getElementById('backend-url').textContent = finalUrl;
                document.getElementById('backend-status').textContent = 'å·²ä¿å­˜';
                
                showResult('status-result', 'success', 
                    `âœ… é…ç½®å·²ä¿å­˜\nåç«¯åœ°å€: ${finalUrl}\næ­£åœ¨é‡æ–°è¿æ¥...`);
                
                // é‡æ–°æ£€æŸ¥çŠ¶æ€
                setTimeout(checkBackendStatus, 1000);
            } catch (error) {
                showResult('status-result', 'error', 
                    'âŒ æ— æ•ˆçš„URLåœ°å€\nè¯·è¾“å…¥å®Œæ•´çš„URL\nä¾‹å¦‚ï¼šhttps://your-backend.onrender.com');
            }
        });
        
        // æ¸…é™¤æ•°æ®
        document.getElementById('clear-data-btn').addEventListener('click', () => {
            if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰æœ¬åœ°æ•°æ®å—ï¼Ÿè¿™å°†åŒ…æ‹¬ç™»å½•çŠ¶æ€å’Œé…ç½®ã€‚')) {
                appState.isLoggedIn = false;
                appState.firebaseToken = '';
                appState.userEmail = '';
                appState.userId = '';
                appState.backendUrl = '';
                
                localStorage.removeItem('backendUrl');
                backendConfigInput.value = '';
                
                modifyBtn.disabled = true;
                document.getElementById('current-user-email').textContent = 'è¯·å…ˆç™»å½•';
                document.getElementById('login-status').style.display = 'none';
                document.getElementById('backend-url').textContent = 'ç­‰å¾…é…ç½®';
                document.getElementById('backend-status').textContent = 'æœªé…ç½®';
                document.getElementById('connection-status').textContent = 'æœªè¿æ¥';
                
                showResult('status-result', 'success', 
                    'âœ… æœ¬åœ°æ•°æ®å·²æ¸…é™¤\né…ç½®å·²é‡ç½®\nè¯·é‡æ–°è¾“å…¥åç«¯åœ°å€');
            }
        });
        
        // æ˜¾ç¤ºç»“æœçš„è¾…åŠ©å‡½æ•°
        function showResult(containerId, type, message) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            container.className = `result-container show ${type}`;
            
            let title = container.querySelector('.result-title');
            let content = container.querySelector('.result-content');
            
            if (!title) {
                title = document.createElement('div');
                title.className = 'result-title';
                container.appendChild(title);
            }
            
            if (!content) {
                content = document.createElement('div');
                content.className = 'result-content';
                container.appendChild(content);
            }
            
            const icon = type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : 'âš ï¸';
            const titleText = type === 'success' ? 'æ“ä½œæˆåŠŸ' : type === 'error' ? 'æ“ä½œå¤±è´¥' : 'æç¤ºä¿¡æ¯';
            title.innerHTML = `<span>${icon} ${titleText}</span>`;
            content.textContent = message;
            
            // è‡ªåŠ¨æ»šåŠ¨åˆ°ç»“æœ
            container.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
    </script>
</body>
</html>
